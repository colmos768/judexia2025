{% extends 'base.html' %}
{% block content %}
<div class="p-6">
    <h2 class="text-2xl font-bold mb-4">Gesti√≥n de Formatos Legales</h2>

    <form method="POST" enctype="multipart/form-data" class="mb-6 space-y-2">
        <input type="file" name="archivo" required class="block">
        <input type="text" name="usuario" placeholder="Nombre del usuario" class="border px-2 py-1 w-full">
        <select name="causa_id" class="border px-2 py-1 w-full">
            <option value="">(Opcional) Asociar a una causa</option>
            {% for causa in causas %}
                <option value="{{ causa.id }}">{{ causa.tipo }} - {{ causa.rol }}</option>
            {% endfor %}
        </select>
        <input type="text" name="observaciones" placeholder="Observaciones (opcional)" class="border px-2 py-1 w-full">
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Subir formato</button>
    </form>

    <ul class="space-y-3">
        {% for f in formatos %}
        <li class="bg-gray-100 p-4 rounded flex justify-between items-center">
            <div>
                <strong>{{ f.nombre_original }}</strong><br>
                Usuario: {{ f.usuario or 'N/D' }} | Fecha: {{ f.fecha_subida.strftime('%d-%m-%Y') }}
                {% if f.causa %} | Causa: {{ f.causa.tipo }} {{ f.causa.rol }}{% endif %}
                {% if f.observaciones %}<br>üìù {{ f.observaciones }}{% endif %}
            </div>
            <div class="flex gap-4 items-center">
                <a href="{{ url_for('static', filename='formatos/' ~ f.filename) }}" target="_blank" class="text-blue-600 underline">Ver</a>
                <form method="POST" action="{{ url_for('eliminar_formato', id=f.id) }}">
                    <button type="submit" class="text-red-600 hover:underline">Eliminar</button>
                </form>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
