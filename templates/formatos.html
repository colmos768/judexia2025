{% extends 'base.html' %}
{% block content %}

<div class="p-6 max-w-4xl mx-auto bg-white rounded-xl shadow-md space-y-6">

    <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2">üìÇ Gesti√≥n de Formatos Legales</h2>

<form method="GET" action="{{ url_for('formatos') }}" class="space-y-4">

    <form action="{{ url_for('formatos') }}" method="POST" enctype="multipart/form-data">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Buscar por nombre</label>
                <select name="buscar_nombre" class="w-full p-2 border rounded bg-gray-50">
                    <option value="">-- Seleccionar --</option>
                    {% for nombre in nombres %}
                        <option value="{{ nombre }}">{{ nombre }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Buscar por usuario</label>
                <select name="buscar_usuario" class="w-full p-2 border rounded bg-gray-50">
                    <option value="">-- Seleccionar --</option>
                    {% for usuario in usuarios %}
                        <option value="{{ usuario }}">{{ usuario }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Todas las causas</label>
                <select name="causa" class="w-full p-2 border rounded bg-gray-50">
                    <option value="">-- Seleccionar --</option>
                    {% for causa in causas %}
                        <option value="{{ causa }}">{{ causa }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Seleccionar archivo</label>
                <input type="file" name="archivo" required class="w-full p-2 border rounded bg-white file:bg-judexia file:text-white file:rounded file:px-4 file:py-2 file:cursor-pointer" />
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Nombre del usuario</label>
                <input type="text" name="usuario" required class="w-full p-2 border rounded bg-gray-50" />
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">(Opcional) Asociar a una causa</label>
                <select name="asociar_causa" class="w-full p-2 border rounded bg-gray-50">
                    <option value="">-- Ninguna --</option>
                    {% for causa in causas %}
                        <option value="{{ causa }}">{{ causa }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700">Observaciones (opcional)</label>
            <textarea name="observaciones" rows="2" class="w-full p-2 border rounded bg-gray-50"></textarea>
        </div>

        <div class="flex justify-end">
            <button type="submit" class="bg-judexia hover:bg-blue-800 text-white font-semibold py-2 px-6 rounded transition">
                üì§ Subir formato
            </button>
        </div>
    </form>

    <hr class="border-t mt-6" />

    <h3 class="text-xl font-semibold text-gray-800 mt-4">üìÅ Formatos disponibles</h3>
    <div id="lista-formatos" class="space-y-2">
        <!-- Se llenar√° por JS -->
    </div>

</div>

<script>
    fetch('/formatos_disponibles')
        .then(response => response.json())
        .then(data => {
            const lista = document.getElementById('lista-formatos');
            if (data.length === 0) {
                lista.innerHTML = "<p class='text-gray-500'>No hay formatos cargados.</p>";
            } else {
                data.forEach(formato => {
                    const item = document.createElement('div');
                    item.className = 'p-3 rounded border flex justify-between items-center bg-gray-50';
                    item.innerHTML = `
                        <span class="text-sm text-gray-700 truncate w-2/3">${formato.nombre}</span>
                        <a href="/${formato.ruta}" download class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1 rounded text-sm">Descargar</a>
                    `;
                    lista.appendChild(item);
                });
            }
        });
</script>

<style>
    .bg-judexia {
        background-color: #1f2a60; /* azul institucional */
    }
</style>

{% endblock %}



