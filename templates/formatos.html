{% extends 'base.html' %}
{% block content %}

<div class="p-5 bg-white rounded shadow-sm mx-auto" style="max-width: 960px;">

  <h2 class="mb-4 fw-semibold fs-4 text-primary border-bottom pb-2">
    üìÇ Gesti√≥n de Formatos Legales
  </h2>

  <!-- FORMULARIO DE FILTRO -->
  <form method="GET" action="{{ url_for('formatos') }}" class="row g-3 mb-4">
    <div class="col-md-4">
      <input type="text" name="nombre" class="form-control" placeholder="Buscar por nombre" value="{{ filtro_nombre }}">
    </div>
    <div class="col-md-4">
      <input type="text" name="usuario" class="form-control" placeholder="Buscar por usuario" value="{{ filtro_usuario }}">
    </div>
    <div class="col-md-4">
      <select name="causa_id" class="form-select">
        <option value="">Todas las causas</option>
        {% for causa in causas %}
          <option value="{{ causa.id }}" {% if filtro_causa == causa.id|string %}selected{% endif %}>
            {{ causa.tipo }} - {{ causa.rol }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-12 text-end">
      <button type="submit" class="btn btn-judexia">
        üîç Aplicar filtros
      </button>
    </div>
  </form>

  <!-- FORMULARIO DE SUBIDA -->
  <form action="{{ url_for('formatos') }}" method="POST" enctype="multipart/form-data" class="row g-3 mb-5">
    <div class="col-md-6">
      <label class="form-label">Seleccionar archivo</label>
      <input type="file" name="archivo" required class="form-control">
    </div>
    <div class="col-md-6">
      <label class="form-label">Nombre del usuario</label>
      <input type="text" name="usuario" class="form-control">
    </div>
    <div class="col-md-6">
      <label class="form-label">(Opcional) Asociar a una causa</label>
      <select name="causa_id" class="form-select">
        <option value="">-- Ninguna --</option>
        {% for causa in causas %}
          <option value="{{ causa.id }}">{{ causa.tipo }} - {{ causa.rol }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-6">
      <label class="form-label">Observaciones (opcional)</label>
      <input type="text" name="observaciones" class="form-control">
    </div>
    <div class="col-12 text-end">
      <button type="submit" class="btn btn-verde">
        üì§ Subir formato
      </button>
    </div>
  </form>

  <!-- LISTA DE FORMATOS -->
  <h4 class="fw-semibold mb-3">üìÅ Formatos disponibles</h4>

  {% if formatos %}
    <div class="list-group">
      {% for formato in formatos %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <div class="me-auto">
            <a href="{{ url_for('static', filename='formatos/' + formato.filename) }}"
               class="text-decoration-none fw-medium text-primary"
               target="_blank">
              {{ formato.nombre_original }}
            </a>
            <div class="text-muted small">
              Subido por {{ formato.usuario or "Desconocido" }} el {{ formato.fecha_subida.strftime('%d-%m-%Y') }}
              {% if formato.observaciones %} ‚Äì {{ formato.observaciones }}{% endif %}
            </div>
          </div>
          <form action="{{ url_for('eliminar_formato', id=formato.id) }}" method="POST">
            <button class="btn btn-sm btn-rojo">Eliminar</button>
          </form>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No hay formatos a√∫n.</p>
  {% endif %}

</div>

{% endblock %}




